# §1 プロセス > 1.1 序論 > 1.1.2 再起 (prefix) / 1.1.3 選択

[ホーアCSPモデルの理論][p5-p10]


## (ふりかえり)

### プロセス→プロセス の禁

前回のラストだが

> PとQがプロセスであれば
> ```
> P→Q
> ```
> は構文上の誤りである.

は実はしっくりこない。 (構文はわかる。左辺はアルファベットでなければいけない)

P = e1 → e2 → e3 → STOP<sub>αP</sub>

Q = e4 → e5 → e6 → STOP<sub>αQ</sub>

としたとき、 P→Q は

e1 → e2 → e3 → STOP<sub>αP</sub> → e4 → e5 → e6 → STOP<sub>αQ</sub>

となるはずで、意味としてはありそうに感じるから。

プロセスとはなにか？がよくわかっていないことが起因かと思われる

### 自動販売機の例がよくわからない件について

以下のような意味を与えるとわかりやすい

(coin → (choc → (coin →　(choc → STOP<sub>αVMS</sub>))))

|StepNo.|イベント    |イベント(JP)     |  |コイン投入口|チョコ取出口|事後のプロセス式                                    |
|------:|------------|---------------|---|------------|------------|----------------------------------------------------|
|1      | (entry)    |               |→ | 開         | 閉         | (coin→(choc→(coin→(choc→STOP<sub>αVMS</sub>))))|
|2      | coin       | コインを投入する|→ | 閉         | 開         | (choc→(coin→(choc→STOP<sub>αVMS</sub>)))        |
|3      | choc       | チョコを取り出す|→ | 開         | 閉         | (coin→(choc→STOP<sub>αVMS</sub>))                |
|4      | coin       | コインを投入する|→ | 閉         | 開         | (choc→STOP<sub>αVMS</sub>)                        |
|5      | choc       | チョコを取り出す|→ | 閉         | 閉         | STOP<sub>αVMS</sub>                                |

コイン投入口があいているとき、ユーザーがコインを投入すると、

* コイン投入口が閉じ、
* チョコがひとつ、チョコ取出し口に置かれ
* チョコ取り出し口が開く

ユーザーがチョコを取り出すと

* チョコ取り出し口が閉じ、
* チョコの在庫あれば、コイン投入口が開く　

というマシーン.

p4 の記述

> この自動販売機は, 初期状態では高価を入れることはできるが, チョコレートを取り出すことはできない. しかし, 最初の硬貨を入れると, 硬貨挿入口はチョコレートが取り出されるまで閉じている.

を見る限り、この例では　choc は **自販機がチョコを排出するアクション** を示さない。


 ◆　◆　◆


ただ、自販機がチョコを排出口に出すというイベントによめてしまう。その場合、同期しない
（アトミックに遷移するなら一つのイベントである）

## 1.1.3 再帰

ループがないなら再起しな。

```
αClock = {tick}
Clock = tick → tick → tick → tick → ...
```

は、

```
Clock = (tick → Clock)
```

のように書く。これが無限に刻む時計であることを示すため、展開してみよう。

```
  CLOCK = (tick → CLOCK)
== {CLOCK に (tick → CLOCK) を代入}
  CLOCK = (tick → (tick → CLOCK))
== {同様に代入}
  CLOCK = (tick → (tick → (tick → CLOCK)))
```

> プロセスの自己参照または再帰的な定義法が正しいための必要条件は, 等式の右辺第1項が少なくとも1つ以上のイベントであり, それが再帰的に現れるすべてのプロセス名に対して接頭辞となっていることである。

これを保護（ガード）されているという。

### μ記法

```
μX: A.F(X)

X   : プロセス
F(X): プロセス名Xを含む保護されたプロセス式
A   : αX
```

たとえば、

```
CLOCK = μX:{tick}. {tick→X}
```

```
  VMS = (coin → (choc →　VMS))
== {μ記法でかく}
  VMS = μX: {coin, choc}. (coin → (choc → X))
```

## 1.1.3 選択

```
(x→P|y→Q)
```

x が起きたら P、yが起きたらQ

この場合のアルファベットはどういうこと？というとこういうことらしい。

* x も y も αP に含まれる
* x も y も αQ に含まれる
* αP と αQ は等しい

> 前述のようにアルファベットが固定であることに注意すること
>
> ```
> α(x→P|y→Q) = αP    ここで {x, y} ⊆ αP かつ αP = αQ
> ```

### 例 X5

最近の電子マネー対応自販機を考える。

EVM は 

* pay100 お支払い (100円)
* sel    商品選択

という２つの（抽象的な)イベントを取る.

100円の商品しかない
かつ100円玉もしくは100円以上の残金のある電子マネーでしか支払えない

とすると、

```
EVM = μX:{pay100, sel}.( pay100→sel→X
                       | sel→pay100→X)
```

と記述できる。

### 例 X6

これはモデルチェッカーがほしい

X5 の顧客信用自販機（後払いOK)

> ```
> VMCRED = μX.(coin→choc→X)
>             |chok→coin→X
> ```

に対し、

> 損をしないために, VMCREDを使用させる場合は,　最初に支払いを要求する.
>
> ```
> VMS2 = (coin → VMCRED)
> ```

を定義する。そのときに、

> この自販機は, 連続して2回チョコレートを取り出す前に, 硬貨を2枚入れても良い. しかし事前に張り込んだ以上にチョコレートを出すことはない.

の挙動があることを見落とす自信があります、わたし。

### ２つ以上の選択肢

```
(x→P|y→Q|z→R)
```

ちなみに、`|` はプロセスに対する演算子 **ではない** 。

ここの章読んでて、 `P □ Q` (外部選択) との違いがよくわかんなかったが、
プロセスではないなら構文上はそうなるというのはわかる。でも、`P = a → Q` なのだから
プロセスで置くことができるほうが自然に感じるんだけどなぁ。

その理由について書かれていて、

> この規則を導入した理由は,
>
> ```
> (x→P)|(x→Q)
> ```
>
> のように、最初のイベントが選択されるように見えるものの、実際には実行できない式に対して意味付けせねばならない問題をさけるためである.

とあるけど、じつはよくわかんなかった。ORという記号を□ (決定的)と┌┐ (非決定的) の２つの意味で分けたかったから？
でも、そうであるなら、`(x → P | x → Q)` も書けるけどなぁ

### (x:B→P(x))

* B ... イベントの任意集合
* x ... x ∈ B
* P(x)  ... プロセス式

> この式は「xがBに属すならば, Pはxの関数である」と読む

これはいい。

> Bの任意のイベントyを最初の選択項としてもち、P(y)のように動作するプロセスが定義される。

が理解しがたかたった。ふむ。

たとえば、

```
B = {x, y, z}

P(x) = (x→Q | y→R | x→S)

B ⊆ αQ = αR = αS
```

とすると、理解できるような気がする。

> 集合Bは, プロセスが起動時にとり得る動作の集合を与えるという点で, プロセスの初期メニューを定義している

につながるのがわかる。

> ```
> (a→P|b→Q) = (x:B → R(x))
> ```

であるならば

> B = {a, b}
> R(x) = if x = a then P else Q

となる。ということみたい。


 ◆　◆　◆


> このように選択, 接頭辞 および `STOP` (停止)　は一般選択記法の特殊な場合として定義できる. このことは, プロセスを支配する一般則 (1.3節) を定式化するにのたいへんな利点となる.

楽しみに待とう。

